# ServiceFlow ‚Äî Backend‚Äë—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –∑–∞—è–≤–∫–∞–º–∏

**ServiceFlow** ‚Äî –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π backend‚Äë—Å–µ—Ä–≤–∏—Å –Ω–∞ **FastAPI**, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.  
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è IT‚Äë–ø–æ–¥–¥–µ—Ä–∂–∫–∏, Helpdesk, HR‚Äë–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ –ª—é–±—ã—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ç–∏–∫–µ—Ç‚Äë—Å–∏—Å—Ç–µ–º –∫–æ–º–ø–∞–Ω–∏–∏.

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç —Ä–æ–ª–µ–≤—É—é –º–æ–¥–µ–ª—å, —Å—Ç—Ä–æ–≥—É—é –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫—É, –∞—É–¥–∏—Ç, –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –∏ Docker‚Äë–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Ä–æ–≤–Ω—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

---

##  TL;DR

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–º–∏ –∑–∞—è–≤–∫–∞–º–∏  
- –†–æ–ª–∏: **ADMIN / AGENT / EMPLOYEE**  
- –°—Ç–∞—Ç—É—Å—ã: **NEW ‚Üí IN_PROGRESS ‚Üí DONE / CANCELED**  
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `X-API-Key`  
- PostgreSQL + SQLAlchemy 2.0 + Alembic  
- Docker Compose + –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã (Pytest)  
- –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Routers ‚Üí Services ‚Üí ORM ‚Üí DB  

**–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫:**
```bash
docker compose up --build
````

API: <http://localhost:8000>\
Swagger UI: <http://localhost:8000/docs>

***

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞:

    Client ‚Üí FastAPI Routers ‚Üí Services ‚Üí ORM ‚Üí PostgreSQL

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

*   API-Key –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
*   –ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π
*   Alembic-–º–∏–≥—Ä–∞—Ü–∏–∏
*   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è seed‚Äë–¥–∞–Ω–Ω—ã—Ö

```mermaid
flowchart TB
    Client["Client (Web or Bot)"]
    Routers["FastAPI Routers"]
    Services["Services (Business Logic)"]
    ORM["SQLAlchemy ORM"]
    DB[(PostgreSQL)]

    Client --> Routers
    Routers --> Services
    Services --> ORM
    ORM --> DB

    Auth["API Key Auth"] --> Routers
    Logs["Audit Logs"] --> Services
    Alembic["Alembic Migrations"] --> DB
```

***

##  –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

*   —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–º–∏ –∑–∞—è–≤–∫–∞–º–∏ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å–∞–º–∏
*   —Å—Ç—Ä–æ–≥–∞—è –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤
*   —Ä–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å:
    *   **ADMIN** ‚Äî –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–∏—Å—Ç–µ–º—ã
    *   **AGENT** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –∑–∞—è–≤–æ–∫
    *   **EMPLOYEE** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫
*   –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ `X-API-Key`
*   –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
*   `UUID` / `public_id` –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
*   –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic
*   –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
*   –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã (Pytest)

***

##  –õ–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

    NEW
      ‚Ü≥ IN_PROGRESS
          ‚Ü≥ DONE
          ‚Ü≥ CANCELED

–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è** —Å–µ—Ä–≤–∏—Å–Ω—ã–º —Å–ª–æ–µ–º.

***

##  –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫:

    X-API-Key: <—Ç–≤–æ–π_–∫–ª—é—á>

***

##  ERD (—Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)

–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:

*   `users`
*   `requests`
*   `audit_logs`
*   `roles`

–°–≤—è–∑–∏:

*   users (1) ‚Üí (N) requests
*   users (1) ‚Üí (N) audit\_logs

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

*   UUID –∫–∞–∫ primary key
*   public\_id –∫–∞–∫ –≤–Ω–µ—à–Ω–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä

***

##  –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

*   Python 3
*   FastAPI
*   SQLAlchemy 2.0
*   PostgreSQL
*   Alembic
*   Docker / Docker Compose
*   Pytest

***

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

    app/
      core/         # –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      routers/      # HTTP-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã API
      schemas/      # Pydantic-—Å—Ö–µ–º—ã
      models/       # ORM-–º–æ–¥–µ–ª–∏
      services/     # –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

    alembic/        # –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    tests/          # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã

***

##  –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

*   Docker
*   Docker Compose

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/RiobVO/ServiceFlow.git
cd ServiceFlow
```

### 2. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å

```bash
docker compose up --build
```

### 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
docker compose exec backend alembic upgrade head
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

*   API: <http://localhost:8000>
*   Swagger UI: <http://localhost:8000/docs>

***

##  –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

*   `DATABASE_URL_POSTGRES`
*   `API_KEY`
*   `ADMIN_BOOTSTRAP_KEY`

–ü—Ä–∏–º–µ—Ä—ã ‚Äî –≤ `.env.example`.

***

##  –ü—Ä–∏–º–µ—Ä: –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏

    PATCH /requests/{id}/status
    X-API-Key: AGENT_API_KEY

Body:

```json
{
  "status": "IN_PROGRESS"
}
```

***

##  –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
docker compose exec backend pytest
```

***

## –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è

*   —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
*   healthcheck —Å–µ—Ä–≤–∏—Å–∞
*   —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API‚Äë–∫–ª—é—á–∞–º–∏
*   —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞—É–¥–∏—Ç
*   ERD –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã –±–∏–∑–Ω–µ—Å‚Äë–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
*   web‚Äë–∞–¥–º–∏–Ω–∫–∞ –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram‚Äë–±–æ—Ç–æ–º


***

## Frontend (React + Vite)

–î–æ–±–∞–≤–ª–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ **React + TypeScript + Vite** —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ **React Router** –∏ —Å–≤—è–∑–∫–æ–π —á–µ—Ä–µ–∑ REST API.

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```bash
cd frontend
cp .env.example .env
npm install
npm run dev
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–∂–∏–¥–∞–µ—Ç backend –Ω–∞ <http://localhost:8000> –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ <http://localhost:5173>.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ frontend

```
frontend/
  src/
    components/   # layout-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    pages/        # —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –º–∞—Ä—à—Ä—É—Ç—ã
    services/     # API-–∫–ª–∏–µ–Ω—Ç
    utils/        # —Ö—É–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã
    styles/       # –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
```

### –ü—Ä–∏–º–µ—Ä REST-–∑–∞–ø—Ä–æ—Å–∞

```bash
curl -H "X-API-Key: <API_KEY>" http://localhost:8000/requests
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

```ts
import { api } from "./services/api";

const data = await api.listRequests(apiKey, "?limit=5");
```
